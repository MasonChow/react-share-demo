"use strict";(globalThis.webpackChunkreact_share=globalThis.webpackChunkreact_share||[]).push([[582],{3582:(e,t,s)=>{s.r(t),s.d(t,{default:()=>w,snake:()=>k});var i=s(2791),n=s(6871),o=s(184);const r=function(e){let{isActive:t}=e;return(0,o.jsx)("div",{className:["block",t&&"active"].join(" ")})};const c=function(){const[e,t]=(0,i.useState)([]),[s,n]=(0,i.useState)("");return(0,i.useEffect)((()=>{k.start();const e=k.on(((e,s)=>{"move"===e&&t(s.body),"new_feed"===e&&n(s.feed)}));return()=>{e.off()}}),[]),(0,o.jsx)("div",{style:k.backgroundStyle,children:k.blocks.map((t=>(0,o.jsx)(r,{isActive:e.includes(t.id)||s===t.id},t.id)))})};const d=function(e){let{id:t}=e;const s=(0,i.useContext)(h),n=s.body.includes(t)||s.feed===t;return(0,i.useMemo)((()=>(0,o.jsx)("div",{className:["block",n&&"active"].join(" ")})),[n])},h=i.createContext({body:[],feed:""});const l=function(){const[e,t]=(0,i.useState)([]),[s,n]=(0,i.useState)("");(0,i.useEffect)((()=>{k.start();const e=k.on(((e,s)=>{"move"===e&&t(s.body),"new_feed"===e&&n(s.feed)}));return()=>{e.off()}}),[]);const r=(0,i.useMemo)((()=>(0,o.jsx)("div",{style:k.backgroundStyle,children:k.blocks.map((e=>(0,o.jsx)(d,{id:e.id},e.id)))})),[]);return(0,o.jsx)(h.Provider,{value:{body:e,feed:s},children:r})};const u=function(e){let{id:t,subscribeChange:s}=e;const[n,r]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{s&&t&&s(t,(e=>{r(e)}))}),[t,s]),(0,o.jsx)("div",{className:["block",n&&"active"].filter(Boolean).join(" ")})};const a=function(){const e=(0,i.useRef)({lastBody:[],subscribeBlocks:{}}),t=(0,i.useCallback)(((t,s)=>{e.current.subscribeBlocks[t]=s}),[]);return(0,i.useEffect)((()=>{k.start();const t=k.on(((t,s)=>{if("move"===t){var i,n;const t=s.body,{subscribeBlocks:o,lastBody:r}=e.current,c=t[0],d=r[r.length-1];null===(i=o[c])||void 0===i||i.call(o,!0),null===(n=o[d])||void 0===n||n.call(o,!1),e.current.lastBody=t}}));return()=>{t.off(),e.current={lastBody:[],subscribeBlocks:{}}}}),[]),(0,o.jsx)("div",{style:k.backgroundStyle,children:k.blocks.map((e=>(0,o.jsx)(u,{id:e.id,subscribeChange:t},e.id)))})};var b=s(1127),f=s.n(b),v=s(8111),m=s.n(v);let p;!function(e){e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Left=3]="Left",e[e.Right=4]="Right"}(p||(p={}));const y={ArrowUp:p.Up,ArrowDown:p.Down,ArrowLeft:p.Left,ArrowRight:p.Right};function g(e,t){return[e,t].join("_")}const k=new class{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{size:20,speed:1e3};this.width=0,this.height=0,this.direction=p.Right,this.body=[],this.eventSubscribes=[],this.feed="",this.intervalId=0,this.size=20,this.speed=1e3,this.blocks=[],this.lineCount=0,this.columnCount=0,this.backgroundStyle={},this.init(e,t,s)}on(e){const t=[+new Date,f()(0,1e3)].join("_");return this.eventSubscribes.push({id:t,fn:e}),{off:()=>{this.unSubscribes(t)}}}publish(e){const t={body:this.body,feed:this.feed};this.eventSubscribes.forEach((s=>{var i;null===s||void 0===s||null===(i=s.fn)||void 0===i||i.call(s,e,t)}))}unSubscribes(e){this.eventSubscribes=this.eventSubscribes.filter((t=>t.id!==e))}init(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{size:20,speed:1e3};const{size:i,speed:n}=s;return this.setBackground(e,t,i),this.createBody(Math.ceil(e/i/5)),this.speed=n,document.addEventListener("keydown",(e=>{if(Object.keys(y).includes(e.key)){const t=e.key;this.changeDirection(y[t])}})),this}start(){setTimeout((()=>{this.run(),this.createFeed()}),0)}stop(){this.intervalId&&clearInterval(this.intervalId)}gameOver(){this.stop(),this.publish("game_over")}changeDirection(e){e!==this.direction&&(m()([e,this.direction].sort(),[p.Up,p.Down].sort())||m()([e,this.direction].sort(),[p.Left,p.Right].sort())||(this.direction=e))}run(){this.intervalId||(this.intervalId=window.setInterval((()=>{this.move()}),this.speed))}move(){const e=[...this.moveBody(this.body)],t=e[0];return this.body.includes(t)&&this.gameOver(),t===this.feed?this.createFeed():e.pop(),this.body=e,this.publish("move"),this}moveBody(e){const t=[...e];let[s,i]=function(e){const[t=0,s=0]=e.split("_");return[t,s]}(e[0]).map(Number);switch(this.direction){case p.Left:s-=1;break;case p.Right:s+=1;break;case p.Up:i-=1;break;case p.Down:i+=1}return s<0?s=this.columnCount-1:s>=this.columnCount&&(s=0),i<0?i=this.lineCount-1:i>=this.lineCount&&(i=0),t.unshift(g(s,i)),t}createBody(e){let t=[this.randomPoint];for(let s=0;s<e;s++)t=this.moveBody(t);this.body=t}get randomPoint(){let e=g(f()(0,this.lineCount-1),f()(0,this.columnCount-1));return this.body.includes(e)&&(e=this.randomPoint),e}createFeed(){this.feed=this.randomPoint,this.publish("new_feed")}setBackground(e,t,s){const{blocks:i,lineCount:n,columnCount:o}=function(e,t,s){const i=(e-e%s)/s,n=(t-t%s)/s,o=[];return new Array(n).fill(1).forEach(((e,t)=>{new Array(i).fill(1).forEach(((e,s)=>{o.push({id:[s,t].join("_")})}))})),{blocks:o,lineCount:n,columnCount:i}}(e,t,s);return this.width=e,this.height=t,this.size=s,this.blocks=i,this.lineCount=n,this.columnCount=o,this.backgroundStyle={display:"grid",gridTemplateColumns:`repeat(${o}, ${s}px)`,gridTemplateRows:`repeat(${n}, ${s}px)`,width:e,height:t},this}}(window.innerWidth,window.innerHeight,{size:100,speed:1e3});const w=function(){return(0,o.jsxs)("div",{className:"layout",children:[(0,o.jsxs)(n.Z5,{children:[(0,o.jsx)(n.AW,{path:"demo1",element:(0,o.jsx)(c,{})}),(0,o.jsx)(n.AW,{path:"demo2",element:(0,o.jsx)(l,{})}),(0,o.jsx)(n.AW,{path:"demo3",element:(0,o.jsx)(a,{})})]}),(0,o.jsxs)("div",{className:"info",children:[(0,o.jsxs)("p",{children:["\u683c\u5b50\u603b\u6570: ",k.blocks.length]}),(0,o.jsxs)("p",{children:["\u79fb\u52a8\u9891\u7387: ",k.speed,"ms/\u6b21"]})]})]})}}}]);
//# sourceMappingURL=582.d1c3d3b4.chunk.js.map